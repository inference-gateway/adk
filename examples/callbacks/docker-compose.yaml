---
services:
  gateway:
    image: ghcr.io/inference-gateway/inference-gateway:latest
    pull_policy: always
    ports:
      - 8080:8080
    environment:
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      DEEPSEEK_API_KEY: ${DEEPSEEK_API_KEY}
      GOOGLE_API_KEY: ${GOOGLE_API_KEY}
      CLOUDFLARE_API_KEY: ${CLOUDFLARE_API_KEY}
      COHERE_API_KEY: ${COHERE_API_KEY}
      MISTRAL_API_KEY: ${MISTRAL_API_KEY}
      GROQ_API_KEY: ${GROQ_API_KEY}
      LOG_LEVEL: info
    networks:
      - a2a-network

  server:
    build:
      context: ../..
      dockerfile: examples/Dockerfile.server
      args:
        AGENT_NAME: callbacks-agent
        AGENT_DESCRIPTION: Demonstrates callback hooks for agent lifecycle
        AGENT_VERSION: 0.1.0
        EXAMPLE_PATH: examples/callbacks
        COMPONENT: server
    depends_on:
      - gateway
    ports:
      - 8081:8080
    environment:
      ENVIRONMENT: development
      A2A_SERVER_PORT: ${A2A_SERVER_PORT:-8080}
      A2A_DEBUG: ${A2A_DEBUG:-true}
      A2A_CAPABILITIES_STREAMING: ${A2A_CAPABILITIES_STREAMING:-true}
      A2A_AGENT_CLIENT_BASE_URL: ${A2A_AGENT_CLIENT_BASE_URL:-http://gateway:8080/v1}
      A2A_AGENT_CLIENT_PROVIDER: ${A2A_AGENT_CLIENT_PROVIDER:-deepseek}
      A2A_AGENT_CLIENT_MODEL: ${A2A_AGENT_CLIENT_MODEL:-deepseek-chat}
    healthcheck:
      test:
        - CMD
        - curl
        - --fail
        - --silent
        - http://localhost:8080/health
      interval: 5s
      timeout: 3s
      retries: 5
      start_period: 10s
    networks:
      - a2a-network

networks:
  a2a-network:
    driver: bridge
